{% extends "base.html" %}

{% block title %}Current Access Report - AccessPoint{% endblock %}

{% block head_extra %}
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <!-- Pass log data -->
    <script>
      window.logData = {{ logs_data | default([]) | tojson }}; /* Added default empty list */
    </script>
{% endblock %}

{% block content %}
<div class="form-container logs-container">
     <a href="{{ url_for('accesspoint') }}" class="back-link">&larr; Back to AccessPoint</a>
     <h1>Current Access Report</h1>
     <!-- NOTE: Removed the header section with user/logout here, it's now in base.html -->

    {% if error_message %}
        <div class="form-feedback error" style="display: block;">{{ error_message }}</div>
    {% endif %}

    <div class="table-responsive-wrapper">
        <table id="logs-table" class="display compact stripe hover" style="width:100%">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>IP Address</th>
                    <th>Username</th>
                    <th>Action By</th>
                </tr>
            </thead>
            <tbody>
                <!-- DataTables populates this -->
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <!-- DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <!-- DataTables Initialization Script -->
    <script>
        $(document).ready(function() {
            $('#logs-table').DataTable({
                data: window.logData, // Use data passed from head_extra
                columns: [
                    { data: 'Timestamp', render: function ( data, type, row ) { /* ... timestamp formatting ... */
                         if (type === 'display' && data) { try { return new Date(data).toLocaleString(); } catch (e) { return data; } } return data; }
                    },
                    { data: 'IP Address' },
                    { data: 'Username' },
                    { data: 'Action By' }
                ],
                paging: true, searching: true, ordering: true, info: true, lengthChange: true,
                lengthMenu: [ [10, 25, 50, 100, -1], [10, 25, 50, 100, "All"] ],
                order: [[0, 'desc']], responsive: true,
                language: { search: "_INPUT_", searchPlaceholder: "Filter records..." },
                columnDefs: [ { targets: [3], defaultContent: "<i>N/A</i>" } ] // Handle missing 'Action By' data
            });
        });
    </script>
{% endblock %}